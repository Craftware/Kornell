{
    "Parameters": {
        "knldomainname": {
            "Type": "String"
        },
        "knlgwtbucketname": {
            "Type": "String"
        },
        "knlcdnpriceclass": {
            "Type": "String",
            "Default": "PriceClass_100"
        },
        "knlcontentbucketname": {
            "Type": "String"
        },
        "knlapiendpoint": {
            "Type": "String"
        }
    },
    "Resources": {
        "knlcdn": {
            "Type": "AWS::CloudFront::Distribution",
            "Properties": {
                "DistributionConfig": {
                    "Origins": [
                        {
                            "Id": "knlgwtorigin",
                            "DomainName": {
                                "Fn::Join": [
                                    "",
                                    [
                                        {
                                            "Ref": "knlgwtbucketname"
                                        },
                                        ".s3.amazonaws.com"
                                    ]
                                ]
                            },
                            "S3OriginConfig": {}
                        },
                        {
                            "Id": "knlcontentorigin",
                            "DomainName": {
                                "Fn::Join": [
                                    "",
                                    [
                                        {
                                            "Ref": "knlcontentbucketname"
                                        },
                                        ".s3.amazonaws.com"
                                    ]
                                ]
                            },
                            "S3OriginConfig": {}
                        },
                        {
                            "Id": "knlapiorigin",
                            "DomainName": {
                                "Ref": "knlapiendpoint"
                            },
                            "CustomOriginConfig": {
                                "OriginProtocolPolicy": "match-viewer"
                            }
                        }
                    ],
                    "Enabled": "true",
                    "Comment": "Content Distribution",
                    "DefaultRootObject": "Kornell.nocache.html",
                    "Aliases": [
                        {
                            "Fn::Join": [
                                ".",
                                [
                                    {
                                        "Ref": "AWS::StackName"
                                    },
                                    {
                                        "Ref": "knldomainname"
                                    }
                                ]
                            ]
                        }
                    ],
                    "DefaultCacheBehavior": {
                        "AllowedMethods": [
                            "DELETE",
                            "GET",
                            "HEAD",
                            "OPTIONS",
                            "PATCH",
                            "POST",
                            "PUT"
                        ],
                        "TargetOriginId": "knlgwtorigin",
                        "Compress": "true",
                        "ForwardedValues": {
                            "QueryString": "true"
                        },
                        "ViewerProtocolPolicy": "allow-all"
                    },
                    "PriceClass": {
                        "Ref": "knlcdnpriceclass"
                    },
                    "CacheBehaviors": [
                        {
                            "AllowedMethods": [
                                "DELETE",
                                "GET",
                                "HEAD",
                                "OPTIONS",
                                "PATCH",
                                "POST",
                                "PUT"
                            ],
                            "CachedMethods": [
                                "GET",
                                "HEAD",
                                "OPTIONS"
                            ],
                            "Compress": "true",
                            "DefaultTTL": "0",
                            "ForwardedValues": {
                                "Cookies": {
                                    "Forward": "whitelist",
                                    "WhitelistedNames": [
                                        "X-KNL-TOKEN",
                                        "knlLocale"
                                    ]
                                },
                                "Headers": [
                                    "*"
                                ],
                                "QueryString": "true"
                            },
                            "PathPattern": "/api/*",
                            "SmoothStreaming": "false",
                            "TargetOriginId": "knlapiorigin",
                            "ViewerProtocolPolicy": "redirect-to-https"
                        }
                    ]
                }
            }
        }
    }
}